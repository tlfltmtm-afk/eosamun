<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>한자 데이터베이스 검수 도구</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .hanja-char {
            font-size: 8rem;
            line-height: 1;
        }
        .content-card {
            background-color: white;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        #summaryModal {
            display: none;
            /* Add other modal styles */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div id="app" class="container mx-auto p-4 md:p-8">
        
        <!-- 로딩 화면 -->
        <div id="loader" class="text-center py-20">
            <h1 class="text-2xl font-bold">데이터를 불러오는 중입니다...</h1>
            <p class="text-gray-600">잠시만 기다려주세요.</p>
        </div>

        <!-- 메인 컨텐츠 -->
        <main id="main-content" class="hidden">
            <header class="mb-6">
                <h1 class="text-4xl font-bold text-gray-900 mb-2">한자 데이터베이스 검수 도구</h1>
                <p class="text-lg text-gray-600">1-1부터 10-182까지의 데이터를 순서대로 검수합니다.</p>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- 좌측: 데이터 표시 영역 -->
                <div class="lg:col-span-2 space-y-6">
                    <!-- 기본 정보 -->
                    <div class="content-card">
                        <div class="flex items-center justify-between">
                            <div>
                                <h2 id="hanja-id" class="text-2xl font-bold text-indigo-600"></h2>
                                <p id="hanja-serial" class="text-sm text-gray-500"></p>
                            </div>
                            <div id="hanja-char" class="hanja-char text-gray-800"></div>
                        </div>
                        <div class="mt-4">
                            <p class="text-3xl font-semibold" id="hanja-huneum"></p>
                            <p class="text-xl text-gray-600" id="hanja-sound"></p>
                            <p class="mt-2 text-sm text-blue-700 bg-blue-100 rounded-full px-3 py-1 inline-block" id="hanja-textbook"></p>
                        </div>
                    </div>

                    <!-- 상세 설명 -->
                    <div class="content-card">
                        <h3 class="text-xl font-bold mb-3 border-b pb-2">상세 설명</h3>
                        <p id="hanja-explanation" class="text-base leading-relaxed whitespace-pre-wrap"></p>
                    </div>

                    <!-- 뜻과 예문 -->
                    <div class="content-card">
                        <h3 class="text-xl font-bold mb-3 border-b pb-2">뜻과 예문</h3>
                        <div id="hanja-meanings" class="space-y-4"></div>
                    </div>

                    <!-- 관련 단어 -->
                    <div class="content-card">
                        <h3 class="text-xl font-bold mb-3 border-b pb-2">관련 단어</h3>
                        <div id="hanja-vocabulary" class="space-y-4"></div>
                    </div>
                    
                    <!-- 심화 단어 -->
                    <div id="advanced-card" class="content-card">
                        <h3 class="text-xl font-bold mb-3 border-b pb-2">심화 단어</h3>
                        <div id="hanja-advanced-vocabulary" class="flex flex-wrap gap-2"></div>
                    </div>
                </div>

                <!-- 우측: 검수 및 네비게이션 영역 -->
                <div class="lg:col-span-1">
                    <div class="sticky top-8">
                        <div class="content-card">
                            <h3 class="text-xl font-bold mb-4">검수 진행</h3>
                            <div class="flex justify-between items-center bg-gray-200 rounded-lg p-4">
                                <button id="prevBtn" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">&lt; 이전</button>
                                <div id="progress" class="text-center font-semibold text-lg"></div>
                                <button id="nextBtn" class="bg-gray-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-700 transition duration-200 disabled:opacity-50 disabled:cursor-not-allowed">다음 &gt;</button>
                            </div>
                        </div>

                        <div class="content-card">
                            <h3 class="text-xl font-bold mb-4">오류 체크 및 메모</h3>
                            <div class="flex items-center mb-4">
                                <input type="checkbox" id="errorCheck" class="h-6 w-6 rounded border-gray-300 text-red-600 focus:ring-red-500">
                                <label for="errorCheck" class="ml-3 text-lg font-medium text-gray-900">오류 확인</label>
                            </div>
                            <textarea id="memoArea" rows="8" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" placeholder="이 항목에 대한 오류나 특이사항을 메모하세요..."></textarea>
                        </div>
                        
                        <div class="content-card">
                            <h3 class="text-xl font-bold mb-4">검수 현황</h3>
                            <button id="showSummaryBtn" class="w-full bg-indigo-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-indigo-700 transition duration-200">오류 체크 항목 보기</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 오류 요약 모달 -->
    <div id="summaryModal" class="fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center p-4" style="display: none;">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 class="text-2xl font-bold">오류 체크 항목 요약</h2>
                <button id="closeModalBtn" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
            </div>
            <div id="summaryContent" class="p-6 overflow-y-auto">
                <!-- 요약 내용이 여기에 들어갑니다. -->
            </div>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const appState = {
                allData: [],
                currentIndex: 0,
                reviewData: {}
            };

            const ui = {
                loader: document.getElementById('loader'),
                mainContent: document.getElementById('main-content'),
                hanjaId: document.getElementById('hanja-id'),
                serial: document.getElementById('hanja-serial'),
                hanjaChar: document.getElementById('hanja-char'),
                huneum: document.getElementById('hanja-huneum'),
                sound: document.getElementById('hanja-sound'),
                textbook: document.getElementById('hanja-textbook'),
                explanation: document.getElementById('hanja-explanation'),
                meanings: document.getElementById('hanja-meanings'),
                vocabulary: document.getElementById('hanja-vocabulary'),
                advancedCard: document.getElementById('advanced-card'),
                advancedVocabulary: document.getElementById('hanja-advanced-vocabulary'),
                prevBtn: document.getElementById('prevBtn'),
                nextBtn: document.getElementById('nextBtn'),
                progress: document.getElementById('progress'),
                errorCheck: document.getElementById('errorCheck'),
                memoArea: document.getElementById('memoArea'),
                showSummaryBtn: document.getElementById('showSummaryBtn'),
                summaryModal: document.getElementById('summaryModal'),
                closeModalBtn: document.getElementById('closeModalBtn'),
                summaryContent: document.getElementById('summaryContent'),
            };

            async function loadAllData() {
                try {
                    const fileNames = Array.from({ length: 10 }, (_, i) => `data/volume_${i + 1}.json`);
                    const promises = fileNames.map(file => fetch(file).then(res => res.json()));
                    const allVolumes = await Promise.all(promises);
                    
                    appState.allData = allVolumes.flat();
                    appState.allData.sort((a, b) => a.serial - b.serial); // 연번(serial) 기준으로 정렬

                    loadReviewData();
                    
                    // 마지막으로 작업했던 위치 또는 0번 인덱스에서 시작
                    const lastIndex = parseInt(localStorage.getItem('hanja_review_last_index') || '0', 10);
                    appState.currentIndex = (lastIndex < appState.allData.length) ? lastIndex : 0;
                    
                    displayCurrentItem();

                    ui.loader.style.display = 'none';
                    ui.mainContent.classList.remove('hidden');

                } catch (error) {
                    console.error("데이터 로딩 실패:", error);
                    ui.loader.innerHTML = '<h1 class="text-2xl font-bold text-red-500">데이터 로딩에 실패했습니다.</h1><p>파일이 올바른 위치에 있는지 확인해주세요.</p>';
                }
            }

            function displayCurrentItem() {
                const item = appState.allData[appState.currentIndex];
                if (!item) return;

                ui.hanjaId.textContent = `ID: ${item.id}`;
                ui.serial.textContent = `연번: ${item.serial}`;
                ui.hanjaChar.textContent = item.hanja;
                ui.huneum.textContent = item.huneum;
                ui.sound.textContent = `음: ${item.sound}`;
                ui.textbook.textContent = item.textbook || '해당 없음';
                ui.textbook.style.display = item.textbook ? 'inline-block' : 'none';
                ui.explanation.textContent = item.explanation;
                
                // 뜻과 예문 렌더링
                ui.meanings.innerHTML = item.meanings.map(m => `
                    <div class="border-l-4 border-indigo-200 pl-4">
                        <p class="font-semibold text-lg">${m.title}</p>
                        <p class="text-gray-600">${m.definition}</p>
                        <p class="text-gray-800 mt-1 italic">"${m.example}"</p>
                    </div>
                `).join('');

                // 관련 단어 렌더링
                ui.vocabulary.innerHTML = item.vocabulary.map(v => `
                    <div class="border-l-4 border-green-200 pl-4">
                        <p class="font-semibold text-lg">${v.title}</p>
                        <p class="text-gray-600">${v.definition}</p>
                        <p class="text-sm text-gray-500">${v.composition} → ${v.analysis}</p>
                        <p class="text-gray-800 mt-1 italic">"${v.example}"</p>
                    </div>
                `).join('');

                // 심화 단어 렌더링
                if (item.advancedVocabulary && item.advancedVocabulary.length > 0) {
                    ui.advancedVocabulary.innerHTML = item.advancedVocabulary.map(av => `
                        <span class="bg-gray-200 text-gray-700 px-3 py-1 rounded-full text-sm font-medium">${av.word} (${av.linkId})</span>
                    `).join('');
                    ui.advancedCard.style.display = 'block';
                } else {
                    ui.advancedCard.style.display = 'none';
                }

                updateControls();
                loadCurrentReviewState();
            }

            function updateControls() {
                ui.progress.textContent = `${appState.currentIndex + 1} / ${appState.allData.length}`;
                ui.prevBtn.disabled = appState.currentIndex === 0;
                ui.nextBtn.disabled = appState.currentIndex === appState.allData.length - 1;
                localStorage.setItem('hanja_review_last_index', appState.currentIndex);
            }
            
            function loadCurrentReviewState() {
                const currentId = appState.allData[appState.currentIndex].id;
                const state = appState.reviewData[currentId] || { hasError: false, memo: '' };
                ui.errorCheck.checked = state.hasError;
                ui.memoArea.value = state.memo;
            }

            function saveCurrentReviewState() {
                const currentId = appState.allData[appState.currentIndex].id;
                appState.reviewData[currentId] = {
                    hasError: ui.errorCheck.checked,
                    memo: ui.memoArea.value
                };
                saveReviewData();
            }

            function saveReviewData() {
                try {
                    localStorage.setItem('hanja_review_data', JSON.stringify(appState.reviewData));
                } catch (error) {
                    console.error("리뷰 데이터 저장 실패:", error);
                    alert("리뷰 데이터를 저장하는데 실패했습니다. 브라우저 저장 공간이 부족할 수 있습니다.");
                }
            }

            function loadReviewData() {
                const savedData = localStorage.getItem('hanja_review_data');
                if (savedData) {
                    appState.reviewData = JSON.parse(savedData);
                }
            }

            function navigate(direction) {
                const newIndex = appState.currentIndex + direction;
                if (newIndex >= 0 && newIndex < appState.allData.length) {
                    appState.currentIndex = newIndex;
                    displayCurrentItem();
                }
            }
            
            function showSummary() {
                const errorItems = Object.entries(appState.reviewData)
                    .filter(([id, data]) => data.hasError)
                    .map(([id, data]) => ({ ...appState.allData.find(item => item.id === id), ...data }));
                
                if (errorItems.length === 0) {
                    ui.summaryContent.innerHTML = '<p class="text-center text-gray-600">아직 오류로 체크된 항목이 없습니다.</p>';
                } else {
                    ui.summaryContent.innerHTML = `
                        <p class="mb-4 text-lg">총 <strong class="text-red-600">${errorItems.length}개</strong>의 항목이 오류로 체크되었습니다.</p>
                        <div class="space-y-4">
                            ${errorItems.map(item => `
                                <div class="p-4 border rounded-lg bg-gray-50">
                                    <p class="font-bold text-xl">${item.hanja} ${item.huneum} (ID: ${item.id})</p>
                                    <p class="mt-2 p-3 bg-yellow-100 border-l-4 border-yellow-400 text-yellow-800 rounded-r-lg whitespace-pre-wrap">${item.memo || '작성된 메모가 없습니다.'}</p>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                ui.summaryModal.style.display = 'flex';
            }

            // 이벤트 리스너 설정
            ui.prevBtn.addEventListener('click', () => navigate(-1));
            ui.nextBtn.addEventListener('click', () => navigate(1));
            ui.errorCheck.addEventListener('change', saveCurrentReviewState);
            ui.memoArea.addEventListener('input', saveCurrentReviewState);
            
            ui.showSummaryBtn.addEventListener('click', showSummary);
            ui.closeModalBtn.addEventListener('click', () => ui.summaryModal.style.display = 'none');
            ui.summaryModal.addEventListener('click', (e) => {
                if (e.target === ui.summaryModal) {
                    ui.summaryModal.style.display = 'none';
                }
            });


            // 초기화
            loadAllData();
        });
    </script>
</body>
</html>

